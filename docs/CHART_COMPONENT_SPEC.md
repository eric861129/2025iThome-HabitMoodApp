# MindTrack - 關聯性洞察圖表元件技術規格書

- **文件版本**: 1.0
- **作者**: Gemini (數據產品設計師 / 前端架構師)

---

## 1. 元件目標與使用者故事

### 1.1. 核心目標

此元件的核心目標，是實現產品的關鍵價值主張：「**揭示個人行為與內在感受之間的微妙聯繫**」。它將透過數據視覺化的方式，將抽象的日誌數據轉化為使用者能輕易理解、並從中獲得洞察的圖形化介面，賦予使用者改善生活品質的知識與力量。

### 1.2. 使用者故事

本元件直接對應以下核心使用者故事：

> **作為一個**數據導向的使用者，
> **我希望能**看到一個簡單的圖表，將我的心情趨勢與我完成的習慣並列視覺化，
> **這樣我才能**開始識別我的行為與幸福感之間有意義的模式。

---

## 2. 數據契約 (Data Contract / Props)

### 2.1. 架構理念

本圖表將作為一個純粹的**「展示元件 (Presentational Component)」**。它自身不包含任何數據獲取或處理的業務邏輯。其所有渲染內容，完全由外部傳入的 `props` 決定。這種設計確保了元件的高度可複用性與可測試性。

### 2.2. Props 定義

| Prop 名稱   | 資料類型        | 是否必需 | 預設值  | 說明                                                                                                                                                            |
| :---------- | :-------------- | :------- | :------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `data`      | `Array<Object>` | **是**   | `[]`    | 經過上層邏輯處理後的圖表數據陣列。每個物件代表 X 軸上的一個數據點，其結構應為：<br>`{ date: 'YYYY-MM-DD', moodRating: number, completedHabits: Array<string> }` |
| `isLoading` | `boolean`       | 否       | `false` | 用於控制元件是否應顯示為「載入中」狀態。當為 `true` 時，圖表內容將被載入指示器取代。                                                                            |

---

## 3. 核心功能與視覺呈現

所有視覺元素（顏色、字體等）的選擇，都必須嚴格遵循 `STYLE_GUIDE.md` 中的定義。

-   **圖表類型**: 採用**混合圖表 (Combo Chart)**，在同一個座標系中呈現兩種不同的數據系列。

-   **心情趨勢**: 
    -   應使用平滑的**折線圖 (Line Chart)** 來呈現，以展示數據的連續性與趨勢。
    -   線條顏色應使用風格指南中的主色 `var(--primary-color)`。
    -   線條下方可選用同色系的漸層區域填充，以增強視覺效果。

-   **習慣完成**:
    -   在 `completedHabits` 陣列**不為空**的日期數據點上，疊加一個**散點 (Scatter Point)** 作為視覺標記。
    -   散點顏色應使用風格指南中的輔色/強調色 `var(--accent-color)`，以使其足夠醒目。

-   **X 軸 (X-Axis)**:
    -   代表**日期**，應從左至右按時間順序排列。
    -   標籤應清晰易讀，格式建議為 `MM/DD`。

-   **Y 軸 (Y-Axis)**:
    -   代表**心情分數**，範圍為 1 至 5。
    -   應顯示至少三個主要刻度標籤（例如：低、中、高），以輔助使用者快速定位。

-   **圖例 (Legend)**:
    -   必須提供圖例，用以清晰地區分「心情趨勢」折線和「完成習慣」散點。
    -   圖例應放置在圖表下方或右上角，不應遮擋圖表主要內容。

-   **響應式設計 (Responsive Design)**:
    -   在移動端等小螢幕設備上，圖表必須能自動縮放以適應容器寬度。
    -   為避免 X 軸標籤因空間不足而重疊，應實作標籤顯示密度自動調整邏輯（例如：從顯示每天，變為每隔一天或每週顯示一個標籤）。

---

## 4. 互動行為 (Interaction Behavior)

-   **滑鼠懸停/觸控 (Hover/Touch)**:
    -   當使用者的指標（滑鼠或手指）懸停在任一數據點（折線上的節點）上時，必須顯示一個**工具提示 (Tooltip)**。
    -   **Tooltip 內容**: 應清晰地展示該數據點的詳細資訊，至少包含：
        1.  完整日期 (例如: `2025年9月8日`)
        2.  當日心情分數 (例如: `心情: 4/5`)
        3.  當日完成的所有習慣列表 (如果 `completedHabits` 陣列不為空)。
    -   **Tooltip 外觀**: 其背景色、字體、顏色等所有樣式，均需符合 `STYLE_GUIDE.md` 的規範。

-   **圖例點擊 (Legend Click)**:
    -   圖例中的項目應是可點擊的。
    -   點擊圖例中的任一項（例如「完成習慣」），應能切換（顯示/隱藏）該數據系列在圖表上的可見性。
    -   此互動讓使用者可以專注於單一數據系列進行分析。

---

## 5. 狀態與邊界情況 (States & Edge Cases)

元件必須能夠優雅地處理以下幾種情況：

-   **載入中 (`isLoading: true`)**:
    -   當 `isLoading` prop 為 `true` 時，元件的內容區域不應顯示空白。
    -   應顯示一個符合整體設計風格的**骨架屏 (Skeleton Screen)** 或**載入指示器 (Loading Spinner)**，向使用者傳達「正在準備你的洞察報告...」的狀態。

-   **無數據/數據不足 (`data.length < 3`)**:
    -   當傳入的 `data` 陣列長度不足以形成有意義的趨勢時（建議閾值為 3 個數據點），不應渲染一個空的座標軸。
    -   應在元件區域的正中央，顯示一個經過設計的、友好的提示訊息，例如：
        > **「持續記錄幾天，就能解鎖你的個人洞察報告！」**

---

## 6. 無障礙設計 (Accessibility - a11y)

為確保所有使用者（包括使用輔助技術的使用者）都能平等地獲取圖表資訊，本元件必須滿足以下 WCAG 標準：

-   **鍵盤導航 (Keyboard Navigation)**:
    -   使用者必須能使用 `Tab` 鍵將焦點移入圖表元件。
    -   當焦點在圖表上時，必須能使用方向鍵（`←` / `→`）在各個數據點之間遍歷，且每個被遍歷到的數據點都應能觸發其對應的 Tooltip 顯示。

-   **ARIA 屬性**: 
    -   圖表的根 `<svg>` 元素必須包含 `role="img"` 和一個內容豐富的 `aria-label`，例如：`aria-label="一張從 [開始日期] 到 [結束日期] 的心情與習慣關聯圖表。"`。
    -   每個可互動的數據點（或其所屬的 `<g>` 元素）都應有自己的 `role` 和 `aria-label`，用以描述其數據值，例如：`aria-label="9月8日，心情分數為 4 分，完成習慣 2 個。"`。

-   **備用呈現 (Alternative Presentation)**:
    -   必須提供一種讓螢幕閱讀器 (Screen Reader) 使用者能夠線性地、完整地理解圖表數據的機制。
    -   **推薦方案**: 在元件內部，提供一個**視覺上隱藏** (visually-hidden) 的數據表格 (`<table>`)，其內容與圖表所呈現的數據完全對應。這能確保圖表資訊對所有使用者都是 100% 可訪問的。
